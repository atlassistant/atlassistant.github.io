var socket=io.connect('https://mysterious-citadel-61123.herokuapp.com/');function e(tagName,properties,children){var ele=document.createElement(tagName);if(properties){if(properties.class){properties.class.map(o=>ele.classList.add(o));}}
if(children){for(var child of children){if(typeof(child)==='string'){ele.innerText+=child;}else{ele.appendChild(child);}}}
return ele;}
function whichTransitionEvent(){var t;var el=document.createElement('fakeelement');var transitions={'transition':'transitionend','OTransition':'oTransitionEnd','MozTransition':'transitionend','WebkitTransition':'webkitTransitionEnd'}
for(t in transitions){if(el.style[t]!==undefined){return transitions[t];}}}
var thinking=e('div',{class:['chatbox__message','chatbox__message--server']},[e('p',{},'...'),]);var input=document.getElementById('chatbox-input');var chatbox=document.getElementById('chatbox');var messages=document.getElementById('chatbox-messages');var rooms={bedroom:document.getElementById('bedroom'),kitchen:document.getElementById('kitchen'),};var vacuum=document.getElementById('vacuum');var temperature=document.getElementById('temperature');var svg=document.getElementById('vacuum-svg');var currentIteration=0;input.disabled=true;svg.addEventListener('animationstart',function(){currentIteration=0;console.log('animation started');});svg.addEventListener('animationiteration',function(){currentIteration+=1;if(currentIteration%2===0){if(vacuum.classList.contains('vacuum--stopme')){vacuum.classList.remove('vacuum--stopme','vacuum--on');}}});function appendMessage(content,fromServer){var ele=e('div',{class:['chatbox__message',fromServer?'chatbox__message--server':'chatbox__message--client']},[e('p',{},content),]);try{messages.insertBefore(ele,thinking);}catch{messages.appendChild(ele);}
messages.scrollTo(0,messages.scrollHeight);}
function submitMessage(){if(input.value){socket.emit('parse',input.value);appendMessage(input.value,false);input.value='';}
return false;}
socket.on('connect',function(){console.info('Connected to the server!');input.disabled=false;chatbox.classList.add('chatbox--connected');});socket.on('disconnect',function(){input.disabled=true;chatbox.classList.remove('chatbox--connected');});socket.on('answer',function(data){appendMessage(data.text,true);console.info(data);switch(data.meta.skill){case 'lights':data.meta.rooms.forEach(name=>{var room=rooms[name];if(room){if(data.meta.action==='on'){room.classList.remove('light--off');}else{room.classList.add('light--off');}}});break;case 'vacuum':if(data.meta.action==='start'){vacuum.classList.remove('vacuum--stopme');vacuum.classList.add('vacuum--on');}else{vacuum.classList.add('vacuum--stopme');}
break;case 'temperature':temperature.innerText=data.meta.current+'Â°C';break;}});socket.on('ask',function(data){appendMessage(data.text,true);});socket.on('done',function(){messages.removeChild(thinking);});socket.on('thinking',function(){messages.appendChild(thinking);})